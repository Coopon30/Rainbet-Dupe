<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>RainPlay ‚Äî Play-Money Casino (Full: Plane + Tables)</title>
<style>
  :root{--bg:#071022;--card:#0b1220;--accent:#2dd4bf;--text:#e6eef6}
  body{margin:0;font-family:Inter,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#071022,#0b1220);color:var(--text)}
  header{padding:14px 18px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,0.03)}
  h1{margin:0;font-size:18px}
  .container{display:flex;gap:16px;padding:16px}
  .sidebar{width:300px;background:rgba(255,255,255,0.03);padding:12px;border-radius:10px}
  .main{flex:1;background:rgba(255,255,255,0.02);padding:12px;border-radius:10px}
  .balance{font-size:20px;margin:6px 0;color:var(--accent);font-weight:700}
  .preset{display:flex;gap:6px;flex-wrap:wrap;margin:8px 0}
  button{cursor:pointer;border:0;padding:8px 10px;border-radius:6px;background:#111827;color:var(--text)}
  .game-list{display:flex;flex-direction:column;gap:8px}
  .game-card{padding:10px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.015),rgba(255,255,255,0.01));display:flex;justify-content:space-between;align-items:center}
  .play-area{margin-top:12px}
  .row{display:flex;gap:12px;align-items:center}
  input[type=number], select{width:140px;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--text)}
  .msg{margin-top:8px;padding:8px;border-radius:6px;background:rgba(255,255,255,0.02);min-height:36px}
  .small{font-size:13px;color:rgba(230,238,246,.7)}
  /* slots */
  .slots{display:flex;gap:8px;align-items:center}
  .reel{width:72px;height:72px;border-radius:8px;background:#09121a;display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:800}
  /* plinko */
  .plinko-board{width:100%;height:220px;background:linear-gradient(#071218,#071226);border-radius:8px;position:relative;overflow:hidden;border:1px solid rgba(255,255,255,0.02)}
  .peg{width:8px;height:8px;border-radius:50%;background:#8ee3d4;position:absolute;opacity:.8}
  .ball{width:18px;height:18px;border-radius:50%;background:#ffd166;position:absolute;transform:translate(-50%,-50%);box-shadow:0 0 6px rgba(0,0,0,.6)}
  .buckets{display:flex;gap:4px;margin-top:8px}
  .bucket{flex:1;padding:10px;background:#07121a;border-radius:6px;text-align:center}
  /* mines */
  .mine-grid{display:grid;grid-template-columns:repeat(5,56px);gap:6px}
  .cell{width:56px;height:56px;border-radius:6px;background:#08121a;display:flex;align-items:center;justify-content:center;font-weight:700;cursor:pointer}
  .cell.revealed{background:#083b2e}
  .cell.bomb{background:#4c1f1f}
  /* crash & plane */
  .meter{height:16px;background:#08121a;border-radius:8px;overflow:hidden;margin-top:8px}
  .meter-fill{height:100%;width:0%;background:linear-gradient(90deg,#34d399,#06b6d4);transition:width 0.05s linear}
  .plane-track{position:relative;height:120px;background:linear-gradient(90deg,#081523,#061126);border-radius:8px;border:1px solid rgba(255,255,255,0.02);overflow:hidden}
  .plane{position:absolute;top:18px;left:6px;width:64px;height:36px;background:#ffd166;border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:700;color:#000;box-shadow:0 6px 18px rgba(0,0,0,.5)}
  .marker{position:absolute;top:58px;width:18px;height:18px;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:12px}
  .marker.boost{background:#16a34a}
  .marker.ded{background:#b91c1c}
  .carrier{position:absolute;right:6px;bottom:6px;width:100px;height:36px;background:#0ea5a4;border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:700}
  /* NEW roulette area */
  .roulette-wrap{display:flex;gap:18px;align-items:center;flex-wrap:wrap;margin-top:12px}
  .wheel-canvas{background:linear-gradient(#0b141b,#061019);border-radius:50%;box-shadow:0 8px 30px rgba(0,0,0,.6)}
  .bets-panel{max-width:420px;background:rgba(255,255,255,0.02);padding:10px;border-radius:8px}
  .bets-grid{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .bet-btn{padding:8px 10px;border-radius:6px;background:#0f1724;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
  .bets-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .chip{padding:6px 10px;border-radius:999px;background:#111827;border:1px solid rgba(255,255,255,0.04);cursor:pointer}
  .selected{outline:2px solid rgba(45,212,191,0.6)}
  .result-badge{padding:6px 8px;border-radius:6px;background:rgba(255,255,255,0.03)}
  /* blackjack / baccarat */
  .card{display:inline-block;width:48px;height:64px;border-radius:6px;background:#fff;color:#000;margin-right:6px;display:flex;align-items:center;justify-content:center;font-weight:700}
  .table-row{display:flex;gap:12px;align-items:center;margin-top:8px}
  footer{padding:12px;text-align:center;color:rgba(230,238,246,.6);margin-top:14px}
</style>
</head>
<body>
<header>
  <h1>RainPlay ‚Äî Play-Money Casino (Full)</h1>
  <div class="small">Play-money ‚Ä¢ Persisted balance ‚Ä¢ Save locally</div>
</header>

<div class="container">
  <aside class="sidebar">
    <div><div class="small">Balance</div><div id="balance" class="balance">$500.00</div></div>
    <div class="small">Bet amount</div>
    <div style="margin-top:8px" class="row">
      <input id="betInput" type="number" min="1" step="1" value="10">
      <button id="maxBtn">Max</button>
    </div>
    <div class="preset">
      <button class="presetBtn">1</button>
      <button class="presetBtn">5</button>
      <button class="presetBtn">10</button>
      <button class="presetBtn">25</button>
      <button class="presetBtn">50</button>
      <button class="presetBtn">100</button>
    </div>

    <div style="margin-top:12px" class="small">Games</div>
    <div class="game-list" id="gameList">
      <div class="game-card" data-game="coin"><div><strong>Coin Flip</strong><div class="small">1:1 payout</div></div><button class="selectGame">Play</button></div>
      <div class="game-card" data-game="slots"><div><strong>Slots</strong><div class="small">3 reels</div></div><button class="selectGame">Play</button></div>
      <div class="game-card" data-game="plinko"><div><strong>Plinko</strong><div class="small">Drop ball into buckets</div></div><button class="selectGame">Play</button></div>
      <div class="game-card" data-game="mines"><div><strong>Mines</strong><div class="small">Pick safe cells</div></div><button class="selectGame">Play</button></div>
      <div class="game-card" data-game="crash"><div><strong>Crash</strong><div class="small">Cash out before crash</div></div><button class="selectGame">Play</button></div>
      <div class="game-card" data-game="plane"><div><strong>Plane ‚Üí Carrier</strong><div class="small">Boosts & deductions ‚Äî land on carrier</div></div><button class="selectGame">Play</button></div>
      <div class="game-card" data-game="blackjack"><div><strong>Blackjack</strong><div class="small">Beat the dealer (BJ pays 1.5x)</div></div><button class="selectGame">Play</button></div>
      <div class="game-card" data-game="roulette"><div><strong>Roulette</strong><div class="small">Spin wheel ‚Äî click bets</div></div><button class="selectGame">Play</button></div>
      <div class="game-card" data-game="baccarat"><div><strong>Baccarat</strong><div class="small">Bet Player / Banker / Tie</div></div><button class="selectGame">Play</button></div>
    </div>

    <div style="margin-top:14px" class="small">
      <div><strong>Quick actions</strong></div>
      <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
        <button id="resetBtn">Reset Balance</button>
        <button id="clearStorage">Clear All</button>
      </div>
    </div>
  </aside>

  <main class="main">
    <div id="mainHeader"><h2 id="gameTitle">Coin Flip</h2><div class="small" id="subTitle">Pick heads or tails</div></div>

    <div class="play-area" id="playArea">
      <div id="coinGame">
        <div class="row" style="gap:12px;flex-wrap:wrap;margin-top:10px">
          <select id="coinChoice"><option value="heads">Heads</option><option value="tails">Tails</option></select>
          <button id="coinFlipBtn">Flip</button>
          <div class="msg" id="coinMsg">Pick heads or tails and press Flip.</div>
        </div>
      </div>

      <div id="slotsGame" style="display:none">
        <div style="margin-top:8px" class="slots">
          <div id="reel1" class="reel">üçí</div>
          <div id="reel2" class="reel">üçã</div>
          <div id="reel3" class="reel">üîî</div>
        </div>
        <div style="margin-top:12px" class="row">
          <button id="spinBtn">Spin</button>
          <div class="msg" id="slotsMsg">Match symbols to win ‚Äî higher matches pay more.</div>
        </div>
      </div>

      <div id="plinkoGame" style="display:none">
        <div style="margin-top:8px">
          <div class="plinko-board" id="plinkoBoard"></div>
          <div class="buckets" id="plinkoBuckets"></div>
          <div style="margin-top:8px" class="row">
            <button id="dropBtn">Drop Ball</button>
            <div class="msg" id="plinkoMsg">Drop ball and hope it lands in a high-value bucket.</div>
          </div>
        </div>
      </div>

      <div id="minesGame" style="display:none">
        <div style="margin-top:8px">
          <div style="display:flex;gap:12px;align-items:center">
            <label class="small">Mines:</label>
            <select id="mineCount">
              <option value="3">3</option>
              <option value="5" selected>5</option>
              <option value="7">7</option>
            </select>
            <button id="startMinesBtn">Start Round</button>
            <button id="mineCashoutBtn" disabled>Cash Out</button>
            <button id="endMinesBtn" disabled>End / Reveal</button>
            <div class="msg" id="minesMsg" style="flex:1">Choose cells carefully. Start a round to play.</div>
          </div>
          <div style="margin-top:12px" id="mineGridWrap">
            <div class="mine-grid" id="mineGrid"></div>
          </div>
        </div>
      </div>

      <div id="crashGame" style="display:none">
        <div style="margin-top:8px">
          <div style="display:flex;gap:12px;align-items:center">
            <button id="startCrash">Start Round</button>
            <button id="cashoutBtn" disabled>Cash Out</button>
            <div class="small" id="crashMultiplier">Multiplier: x1.00</div>
          </div>
          <div class="meter"><div class="meter-fill" id="crashBar"></div></div>
          <div class="msg" id="crashMsg">Start a round and cash out before the crash.</div>
        </div>
      </div>

      <div id="planeGame" style="display:none">
        <div style="margin-top:8px">
          <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
            <button id="startPlane">Start Flight</button>
            <button id="planeCashout" disabled>Cash Out</button>
            <div class="small" id="planeMultiplier">Multiplier: x1.00</div>
            <div class="msg" id="planeMsg" style="flex:1">Start a flight ‚Äî plane will hit boosts/deductions on the way to the carrier. Cash out anytime.</div>
          </div>

          <div style="margin-top:10px" class="plane-track" id="planeTrack">
            <div class="plane" id="planeEl">‚úàÔ∏è</div>
            <div class="carrier" id="carrierEl">CARRIER</div>
          </div>

          <div style="margin-top:8px" class="row small">
            <div>Flight progress:</div>
            <div style="flex:1" class="meter"><div id="planeProgress" class="meter-fill" style="width:0%"></div></div>
          </div>
        </div>
      </div>

      <div id="blackjackGame" style="display:none">
        <div style="margin-top:8px">
          <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
            <button id="bjDeal">Deal</button>
            <button id="bjHit" disabled>Hit</button>
            <button id="bjStand" disabled>Stand</button>
            <div class="msg" id="bjMsg" style="flex:1">Press Deal to start a hand.</div>
          </div>
          <div class="table-row">
            <div>
              <div class="small">Dealer</div>
              <div id="dealerCards" style="margin-top:8px"></div>
              <div id="dealerScore" class="small"></div>
            </div>
            <div>
              <div class="small">Player</div>
              <div id="playerCards" style="margin-top:8px"></div>
              <div id="playerScore" class="small"></div>
            </div>
          </div>
        </div>
      </div>

      <div id="rouletteGame" style="display:none">
        <div class="roulette-wrap">
          <canvas id="wheelCanvas" class="wheel-canvas" width="360" height="360"></canvas>

          <div class="bets-panel">
            <div style="display:flex;gap:8px;align-items:center">
              <div class="small">Selected bet: <span id="selectedBetDesc">None</span></div>
              <div style="flex:1"></div>
              <div class="small result-badge" id="lastResult">Last: ‚Äî</div>
            </div>

            <div style="margin-top:10px">
              <div class="small">Quick chips</div>
              <div class="bets-row">
                <button class="chip" data-chip="1">$1</button>
                <button class="chip" data-chip="5">$5</button>
                <button class="chip" data-chip="10">$10</button>
                <button class="chip" data-chip="25">$25</button>
                <button class="chip" data-chip="50">$50</button>
                <button class="chip" data-chip="100">$100</button>
              </div>
            </div>

            <div style="margin-top:10px">
              <div class="small">Place a bet (uses 'Bet amount' from left panel)</div>
              <div class="bets-grid" id="betsGrid">
                <button class="bet-btn" data-bettype="color" data-betval="red">Red</button>
                <button class="bet-btn" data-bettype="color" data-betval="black">Black</button>
                <button class="bet-btn" data-bettype="parity" data-betval="even">Even</button>
                <button class="bet-btn" data-bettype="parity" data-betval="odd">Odd</button>
                <button class="bet-btn" data-bettype="range" data-betval="low">1-18</button>
                <button class="bet-btn" data-bettype="range" data-betval="high">19-36</button>
                <button class="bet-btn" data-bettype="dozen" data-betval="1">1st 12</button>
                <button class="bet-btn" data-bettype="dozen" data-betval="2">2nd 12</button>
                <button class="bet-btn" data-bettype="dozen" data-betval="3">3rd 12</button>
              </div>

              <div style="margin-top:8px">
                <div class="small">Pick a specific number</div>
                <div style="display:flex;flex-wrap:wrap;gap:6px;margin-top:6px;max-height:120px;overflow:auto;padding-right:6px" id="numberGrid"></div>
              </div>

              <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
                <button id="clearBets" class="bet-btn">Clear Bets</button>
                <button id="spinWheelBtn" class="bet-btn">Spin Wheel</button>
                <div style="flex:1"></div>
                <div class="small">Total wager: <strong id="totalWager">$0.00</strong></div>
              </div>

              <div class="msg" id="rouletteMsg">Click a bet, set your bet amount, then press Spin.</div>
            </div>
          </div>
        </div>
      </div>

      <div id="baccaratGame" style="display:none">
        <div style="margin-top:8px">
          <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
            <select id="baccBet">
              <option value="player">Bet Player (1:1)</option>
              <option value="banker">Bet Banker (0.95:1)</option>
              <option value="tie">Bet Tie (8:1)</option>
            </select>
            <button id="baccDeal">Deal</button>
            <div class="msg" id="baccMsg" style="flex:1">Choose your side and press Deal.</div>
          </div>
          <div class="table-row" style="margin-top:12px">
            <div>
              <div class="small">Player</div>
              <div id="baccPlayer" style="margin-top:8px"></div>
              <div id="baccPlayerScore" class="small"></div>
            </div>
            <div>
              <div class="small">Banker</div>
              <div id="baccBanker" style="margin-top:8px"></div>
              <div id="baccBankerScore" class="small"></div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>
</div>

<footer>
  Built for fun ‚Ä¢ Play money only ‚Ä¢ Save file locally to run
</footer>

<script>
/* -------------------------
  Persistent balance & helpers
  ------------------------- */
const START_BAL = 500;
const BAL_KEY = 'rainplay_balance_v1';
const CHOICE_KEY = 'rainplay_choice_v1';
function money(v){ return '$' + Number(v).toFixed(2) }
function getBal(){ return parseFloat(localStorage.getItem(BAL_KEY) || START_BAL) }
function setBal(v){ localStorage.setItem(BAL_KEY, Number(v).toFixed(2)); renderBalance(); }
function renderBalance(){ document.getElementById('balance').innerText = money(getBal()); }

if(!localStorage.getItem(BAL_KEY)){ localStorage.setItem(BAL_KEY, START_BAL.toFixed(2)) }
renderBalance();

const betInput = document.getElementById('betInput');
document.getElementById('maxBtn').addEventListener('click', ()=> betInput.value = Math.max(1, Math.floor(getBal())) );
document.querySelectorAll('.presetBtn').forEach(b => b.addEventListener('click', e => betInput.value = Number(e.target.innerText)));
document.getElementById('resetBtn').addEventListener('click', ()=> { if(confirm('Reset balance to $' + START_BAL + '?')) setBal(START_BAL); });
document.getElementById('clearStorage').addEventListener('click', ()=> { if(confirm('Clear storage (balance & settings)?')) { localStorage.clear(); location.reload(); } });

function getBet(){
  let b = Number(betInput.value) || 0; b = Math.floor(b);
  if(b <= 0) throw 'Bet must be > 0';
  if(b > getBal()) throw 'Bet exceeds balance';
  return b;
}

function showMessage(id, txt, ok=true){ const el=document.getElementById(id); if(!el) return; el.innerText = txt; el.style.color = ok ? 'inherit' : '#ffb4b4'; }

/* -------------------------
  Game selector
  ------------------------- */
const gameTitle = document.getElementById('gameTitle');
const subTitle = document.getElementById('subTitle');
function showGame(id){
  ['coinGame','slotsGame','plinkoGame','minesGame','crashGame','planeGame','blackjackGame','rouletteGame','baccaratGame'].forEach(k => {
    const el = document.getElementById(k);
    if(el) el.style.display = 'none';
  });
  document.getElementById(id+'Game').style.display = 'block';
  if(id==='coin'){ gameTitle.innerText = 'Coin Flip'; subTitle.innerText='Pick heads or tails.' }
  if(id==='slots'){ gameTitle.innerText = 'Slots'; subTitle.innerText='Spin 3 reels and match symbols.' }
  if(id==='plinko'){ gameTitle.innerText = 'Plinko'; subTitle.innerText='Drop a ball ‚Äî different buckets pay differently.' }
  if(id==='mines'){ gameTitle.innerText = 'Mines'; subTitle.innerText='Pick safe cells; cash out to collect.' }
  if(id==='crash'){ gameTitle.innerText = 'Crash'; subTitle.innerText='Cash out before the crash to lock multiplier.' }
  if(id==='plane'){ gameTitle.innerText = 'Plane ‚Üí Carrier'; subTitle.innerText='Hit boosts/deductions and try to land on the carrier.' }
  if(id==='blackjack'){ gameTitle.innerText='Blackjack'; subTitle.innerText='Beat the dealer. Blackjack pays 1.5x.' }
  if(id==='roulette'){ gameTitle.innerText='Roulette'; subTitle.innerText='Place bets and spin the wheel' }
  if(id==='baccarat'){ gameTitle.innerText='Baccarat'; subTitle.innerText='Bet on Player / Banker / Tie.' }
  localStorage.setItem(CHOICE_KEY,id);
}
document.querySelectorAll('.selectGame').forEach(btn => btn.addEventListener('click', e => showGame(btn.closest('.game-card').dataset.game)));
showGame(localStorage.getItem(CHOICE_KEY) || 'coin');

/* -------------------------
  Coin, Slots, Plinko, Mines, Crash, Plane (existing)
  (kept from earlier ‚Äî unchanged behavior)
  ------------------------- */
/* Coin */
document.getElementById('coinFlipBtn').addEventListener('click', ()=>{
  try{ const bet = getBet(); const choice = document.getElementById('coinChoice').value; setBal(getBal() - bet);
    const outcome = Math.random() < 0.5 ? 'heads' : 'tails';
    if(outcome === choice){ const payout = bet * 2; setBal(getBal() + payout); showMessage('coinMsg', `You won! It was ${outcome}. You gained ${money(payout - bet)}.`); }
    else showMessage('coinMsg', `You lost. It was ${outcome}. Lost ${money(bet)}.`, false);
  }catch(e){ alert(e) }
});

/* Slots */
const symbols = ['üçí','üçã','üîî','‚≠ê','7Ô∏è‚É£','üçâ'];
function randomSymbol(){ return symbols[Math.floor(Math.random()*symbols.length)] }
document.getElementById('spinBtn').addEventListener('click', async ()=>{
  try{
    const bet = getBet(); setBal(getBal() - bet);
    const r1 = document.getElementById('reel1'), r2 = document.getElementById('reel2'), r3 = document.getElementById('reel3');
    r1.innerText = r2.innerText = r3.innerText = 'üé∞';
    const spins = 12;
    for(let i=0;i<spins;i++){ r1.innerText = randomSymbol(); r2.innerText = randomSymbol(); r3.innerText = randomSymbol(); await new Promise(res => setTimeout(res, 60 + i*6)); }
    const a=r1.innerText,b=r2.innerText,c=r3.innerText; let payout=0;
    if(a===b && b===c){ payout = bet * (a==='7Ô∏è‚É£'?20: a==='‚≠ê'?10:6); } else if(a===b||b===c||a===c){ payout = bet*2; }
    if(payout>0){ setBal(getBal()+payout); showMessage('slotsMsg', `Result: ${a} ${b} ${c} ‚Äî You won ${money(payout - bet)} (payout ${money(payout)}).`); }
    else showMessage('slotsMsg', `Result: ${a} ${b} ${c} ‚Äî No win. Lost ${money(bet)}.`, false);
  }catch(e){ alert(e) }
});

/* Plinko */
const plinkoBoard = document.getElementById('plinkoBoard'), plinkoBuckets = document.getElementById('plinkoBuckets');
function buildPlinko(){ plinkoBoard.innerHTML=''; plinkoBuckets.innerHTML=''; const rows=6, cols=9;
  for(let r=0;r<rows;r++){ for(let c=0;c<cols;c++){ const peg=document.createElement('div'); peg.className='peg'; const leftPct=(c/cols)*100; const topPct=((r+1)/(rows+2))*100; const offset=(r%2===0)?0:6; peg.style.left=`calc(${leftPct}% + ${offset}px)`; peg.style.top=`${topPct}%`; plinkoBoard.appendChild(peg); } }
  const bucketCount=7; for(let i=0;i<bucketCount;i++){ const el=document.createElement('div'); el.className='bucket'; const mult=(1 + Math.abs((i - (bucketCount-1)/2)) * 0.6).toFixed(2); el.innerHTML=`<div>x${mult}</div><div class="small">${(i+1)} slot</div>`; el.dataset.mult=Number(mult); plinkoBuckets.appendChild(el); }
}
buildPlinko(); window.addEventListener('resize', ()=> buildPlinko());
document.getElementById('dropBtn').addEventListener('click', async ()=>{
  try{ const bet = getBet(); setBal(getBal()-bet); showMessage('plinkoMsg','Dropping ball...');
    const board=plinkoBoard; const ball=document.createElement('div'); ball.className='ball'; board.appendChild(ball);
    const box=board.getBoundingClientRect(); let x=Math.random()*box.width; let y=12; ball.style.left=x+'px'; ball.style.top=y+'px';
    const steps=12;
    for(let i=0;i<steps;i++){ await new Promise(r=>setTimeout(r,120)); const center=box.width/2; const drift=(Math.random()-0.5)*(40 - i*2)+(center-x)*0.02; x+=drift; y+=box.height/steps; if(x<10)x=10; if(x>box.width-10)x=box.width-10; ball.style.left=x+'px'; ball.style.top=y+'px'; }
    const buckets=Array.from(plinkoBuckets.children); const idx=Math.min(buckets.length-1, Math.floor(x/(box.width/buckets.length))); const bucket=buckets[idx]; const mult=Number(bucket.dataset.mult)||1; const payout=Math.floor(bet*mult*100)/100; setBal(getBal()+payout);
    showMessage('plinkoMsg', `Ball landed in slot ${idx+1} (x${mult}). Payout ${money(payout)}.`); setTimeout(()=>ball.remove(),1400);
  }catch(e){ alert(e) }
});

/* Mines */
const mineGrid = document.getElementById('mineGrid'), mineCountSelect=document.getElementById('mineCount');
const mineCashoutBtn = document.getElementById('mineCashoutBtn'), endMinesBtn = document.getElementById('endMinesBtn');
let mineState = {active:false,mines:[],revealed:{},picks:0,multiplier:1.0,bet:0,gridSize:25,mineCount:5};
function buildGrid(){ mineGrid.innerHTML=''; for(let i=0;i<25;i++){ const c=document.createElement('div'); c.className='cell'; c.dataset.idx=i; c.innerText=''; mineGrid.appendChild(c); } }
buildGrid();
document.getElementById('startMinesBtn').addEventListener('click', ()=>{ try{ const bet=getBet(); const count=Number(mineCountSelect.value); startMines(bet,count);}catch(e){alert(e)} });
function startMines(bet,mineCount){ setBal(getBal()-bet); mineState.active=true; mineState.mines=[]; mineState.revealed={}; mineState.picks=0; mineState.multiplier=1.0; mineState.bet=bet; mineState.gridSize=25; mineState.mineCount=mineCount;
  const indices=Array.from({length:25},(_,i)=>i); for(let i=0;i<mineCount;i++){ const idx=Math.floor(Math.random()*indices.length); mineState.mines.push(indices.splice(idx,1)[0]); }
  buildGrid(); updateMinesUI(); showMessage('minesMsg', `Round started ‚Äî ${mineCount} mines hidden. Potential payout: ${money(bet * mineState.multiplier)}. Pick a cell or cash out.`); mineCashoutBtn.disabled=false; endMinesBtn.disabled=false;
  document.querySelectorAll('.cell').forEach(cell => { cell.onclick = () => { if(!mineState.active) return; const idx=Number(cell.dataset.idx); if(mineState.revealed[idx]) return; revealCell(cell,idx); } });
}
function revealCell(cell,idx){
  if(mineState.mines.includes(idx)){ cell.classList.add('bomb'); cell.innerText='üí£'; document.querySelectorAll('.cell').forEach(c=>{ const i=Number(c.dataset.idx); if(mineState.mines.includes(i) && !mineState.revealed[i]){ c.classList.add('bomb'); c.innerText='üí£'; } }); mineState.active=false; mineCashoutBtn.disabled=true; endMinesBtn.disabled=true; showMessage('minesMsg', `Boom! You hit a mine. Lost ${money(mineState.bet)}.`, false); return;
  } else { mineState.picks++; mineState.revealed[idx]=true; cell.classList.add('revealed'); cell.innerText='‚úì';
    const safetyFactor = (mineState.gridSize - mineState.mineCount) / mineState.gridSize; const perPick = Math.max(0.18, safetyFactor * 0.6);
    mineState.multiplier = 1 + mineState.picks * perPick; updateMinesUI(); showMessage('minesMsg', `Safe pick #${mineState.picks}. Mult x${mineState.multiplier.toFixed(2)}. Potential payout ${money(mineState.bet * mineState.multiplier)} ‚Äî Cash out to collect or keep going.`); }
}
function updateMinesUI(){ mineCashoutBtn.innerText = `Cash Out (${money(mineState.bet * mineState.multiplier)})`; }
mineCashoutBtn.addEventListener('click', ()=>{ if(!mineState.active) return; const payout=Math.floor(mineState.bet * mineState.multiplier * 100)/100; setBal(getBal()+payout); mineState.active=false; mineCashoutBtn.disabled=true; endMinesBtn.disabled=true; showMessage('minesMsg', `Cashed out at x${mineState.multiplier.toFixed(2)}. Payout ${money(payout)}.`); });
endMinesBtn.addEventListener('click', ()=>{ if(!mineState.active) return; document.querySelectorAll('.cell').forEach(c=>{ const i=Number(c.dataset.idx); if(mineState.mines.includes(i)){ c.classList.add('bomb'); c.innerText='üí£'; } else if(mineState.revealed[i]){ c.classList.add('revealed'); c.innerText='‚úì'; } else { c.innerText=''; } }); mineState.active=false; mineCashoutBtn.disabled=true; endMinesBtn.disabled=true; showMessage('minesMsg', `Round ended. You didn't cash out. Lost ${money(mineState.bet)}.`, false); });

/* Crash */
let crashState = {running:false,multiplier:1.0,crashAt:0,bet:0,interval:null}; const crashBar = document.getElementById('crashBar');
document.getElementById('startCrash').addEventListener('click', ()=>{
  try{
    if(crashState.running) return;
    const bet = getBet(); setBal(getBal()-bet); crashState.running=true; crashState.multiplier=1.0; crashState.bet=bet;
    const r=Math.random(); crashState.crashAt = Math.max(1.0, Math.exp(r*3));
    document.getElementById('cashoutBtn').disabled=false; document.getElementById('crashMsg').innerText='Round started... cash out before crash!'; document.getElementById('crashMultiplier').innerText='Multiplier: x1.00'; crashBar.style.width='0%';
    const grow = ()=>{ if(!crashState.running) return; crashState.multiplier += 0.03 + crashState.multiplier*0.02; const pct = Math.min(100, crashState.multiplier/10*100); crashBar.style.width = pct + '%'; document.getElementById('crashMultiplier').innerText = 'Multiplier: x' + crashState.multiplier.toFixed(2); if(crashState.multiplier >= crashState.crashAt){ crashState.running=false; document.getElementById('cashoutBtn').disabled=true; document.getElementById('crashMsg').innerText = `Crashed at x${crashState.crashAt.toFixed(2)}. You lost ${money(crashState.bet)}.`; clearInterval(crashState.interval); } };
    crashState.interval = setInterval(grow, 80);
  }catch(e){ alert(e) }
});
document.getElementById('cashoutBtn').addEventListener('click', ()=>{ if(!crashState.running) return; crashState.running=false; clearInterval(crashState.interval); const payout=Math.floor(crashState.bet * crashState.multiplier * 100)/100; setBal(getBal()+payout); document.getElementById('crashMsg').innerText = `Cashed out at x${crashState.multiplier.toFixed(2)}. Payout ${money(payout)}.`; document.getElementById('cashoutBtn').disabled=true; });

/* Plane */
const planeEl = document.getElementById('planeEl');
const planeTrack = document.getElementById('planeTrack');
const planeProgressBar = document.getElementById('planeProgress');
const planeMultiplierEl = document.getElementById('planeMultiplier');
const planeMsg = document.getElementById('planeMsg');
const carrierEl = document.getElementById('carrierEl');
const startPlaneBtn = document.getElementById('startPlane');
const planeCashBtn = document.getElementById('planeCashout');

let planeState = {running:false, bet:0, progress:0, multiplier:1.0, markers:[], crashAt:0, interval:null, speed:0.8, carrierBonus:2.0};

function resetPlaneUI(){ Array.from(planeTrack.querySelectorAll('.marker')).forEach(m=>m.remove()); planeEl.style.left='6px'; planeProgressBar.style.width='0%'; planeMultiplierEl.innerText='Multiplier: x1.00'; planeCashBtn.disabled=true; startPlaneBtn.disabled=false; }

function randomMarkers(count, width){
  const arr=[];
  for(let i=0;i<count;i++){
    const pos = 10 + Math.random() * 80;
    const isBoost = Math.random() < 0.7;
    const boostVals = [0.3,0.5,1.0]; const dedVals=[-0.2,-0.4,-0.8];
    const val = isBoost ? boostVals[Math.floor(Math.random()*boostVals.length)] : dedVals[Math.floor(Math.random()*dedVals.length)];
    arr.push({pos, val, handled:false});
  }
  arr.sort((a,b)=>a.pos-b.pos); return arr;
}

function renderMarkers(){ Array.from(planeTrack.querySelectorAll('.marker')).forEach(m=>m.remove()); const maxW = planeTrack.clientWidth;
  planeState.markers.forEach((m,i)=>{ const el=document.createElement('div'); el.className='marker ' + (m.val>0?'boost':'ded'); el.style.left = `calc(${m.pos}% - 9px)`; el.dataset.idx=i; el.title = (m.val>0?'+':'') + m.val.toFixed(2) + 'x'; el.innerText = m.val>0?'+':'‚àí'; planeTrack.appendChild(el); });
}

startPlaneBtn.addEventListener('click', ()=>{
  try{
    if(planeState.running) return;
    const bet = getBet(); setBal(getBal() - bet);
    planeState.running = true; planeState.bet = bet; planeState.progress = 0; planeState.multiplier = 1.0;
    planeState.markers = randomMarkers(4 + Math.floor(Math.random()*4));
    planeState.crashAt = 10 + Math.random() * 85;
    if(Math.random() < 0.1) planeState.crashAt = 200;
    planeState.speed = 0.3 + Math.random() * 1.2;
    planeState.handledMarkers = 0;
    renderMarkers();
    planeMultiplierEl.innerText = 'Multiplier: x1.00';
    planeMsg.innerText = 'Flight started ‚Äî pass boosts/deductions. Cash out before a crash or reach the carrier!';
    planeCashBtn.disabled = false; startPlaneBtn.disabled = true;
    const tickMs = 60;
    planeState.interval = setInterval(()=> {
      planeState.progress += planeState.speed * (tickMs/1000) * 6;
      if(planeState.progress > 100) planeState.progress = 100;
      const trackW = planeTrack.clientWidth - planeEl.clientWidth - 12;
      planeEl.style.left = (6 + (planeState.progress/100) * trackW) + 'px';
      planeProgressBar.style.width = Math.min(100, planeState.progress) + '%';
      planeState.markers.forEach((m,idx) => {
        if(!m.handled && planeState.progress >= m.pos){
          m.handled = true;
          planeState.multiplier = Math.max(0.1, Math.round((planeState.multiplier + m.val) * 100)/100);
          planeMsg.innerText = (m.val>0 ? `Boost +${m.val}x!` : `Deduction ${m.val}x`) + ` New mult x${planeState.multiplier.toFixed(2)}`;
          planeMultiplierEl.innerText = 'Multiplier: x' + planeState.multiplier.toFixed(2);
          const el = planeTrack.querySelector('.marker[data-idx="'+idx+'"]');
          if(el){ el.style.transform = 'scale(1.25)'; setTimeout(()=>el.style.transform='scale(1)',400); }
        }
      });
      if(planeState.progress >= planeState.crashAt && planeState.crashAt <= 100){
        clearInterval(planeState.interval); planeState.running = false; planeCashBtn.disabled = true; startPlaneBtn.disabled = false;
        planeMsg.innerText = `Crashed at ${Math.floor(planeState.crashAt)}%. You lost ${money(planeState.bet)}.`; planeMultiplierEl.innerText = 'Multiplier: x0.00';
        planeEl.innerText = 'üí•'; planeEl.style.background = '#ef4444';
        setTimeout(()=>{ planeEl.innerText='‚úàÔ∏è'; planeEl.style.background='#ffd166'; resetPlaneUI(); }, 1200);
        return;
      }
      if(planeState.progress >= 98){
        clearInterval(planeState.interval); planeState.running = false; planeCashBtn.disabled = true; startPlaneBtn.disabled = false;
        const carrierBonus = planeState.carrierBonus;
        const payout = Math.floor(planeState.bet * planeState.multiplier * (1 + carrierBonus) * 100)/100;
        setBal(getBal() + payout);
        planeMsg.innerText = `Landed on the carrier! Carrier bonus x${carrierBonus.toFixed(2)} applied. Payout ${money(payout)}.`;
        planeMultiplierEl.innerText = 'Multiplier: x' + (planeState.multiplier * (1+carrierBonus)).toFixed(2);
        planeEl.innerText = 'üèÅ'; planeEl.style.background = '#34d399';
        setTimeout(()=>{ planeEl.innerText='‚úàÔ∏è'; planeEl.style.background='#ffd166'; resetPlaneUI(); }, 1600);
        return;
      }
    }, tickMs);
  }catch(e){ alert(e) }
});

planeCashBtn.addEventListener('click', ()=>{
  if(!planeState.running) return;
  planeState.running = false; clearInterval(planeState.interval);
  const payout = Math.floor(planeState.bet * planeState.multiplier * 100)/100;
  setBal(getBal() + payout);
  planeMsg.innerText = `Cashed out at x${planeState.multiplier.toFixed(2)}. Payout ${money(payout)}.`;
  planeMultiplierEl.innerText = 'Multiplier: x' + planeState.multiplier.toFixed(2);
  planeCashBtn.disabled = true; startPlaneBtn.disabled = false;
  planeEl.style.background = '#60a5fa'; setTimeout(()=> planeEl.style.background='#ffd166',500);
  setTimeout(()=> resetPlaneUI(), 900);
});

/* -------------------------
  Blackjack implementation
  ------------------------- */
const bjDealBtn = document.getElementById('bjDeal');
const bjHitBtn = document.getElementById('bjHit');
const bjStandBtn = document.getElementById('bjStand');
const dealerCardsEl = document.getElementById('dealerCards');
const playerCardsEl = document.getElementById('playerCards');
const dealerScoreEl = document.getElementById('dealerScore');
const playerScoreEl = document.getElementById('playerScore');
const bjMsg = document.getElementById('bjMsg');

let bjState = {deck:[], player:[], dealer:[], bet:0, inRound:false, dealerHidden:true};

function makeDeck(){
  const suits=['‚ô†','‚ô•','‚ô¶','‚ô£']; const ranks=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
  const deck=[];
  for(const s of suits) for(const r of ranks) deck.push({suit:s,rank:r});
  for(let i=0;i<3;i++) deck.sort(()=>Math.random()-0.5); // shuffle-ish
  return deck;
}
function cardValue(card){
  if(!card) return 0;
  if(card.rank==='A') return 11;
  if(['J','Q','K'].includes(card.rank)) return 10;
  return Number(card.rank);
}
function handValue(cards){
  let total=0; let aces=0;
  for(const c of cards){ const v=cardValue(c); total += v; if(c.rank==='A') aces++; }
  while(total>21 && aces>0){ total -= 10; aces--; }
  return total;
}
function renderCards(el, cards, hideFirst=false){
  el.innerHTML='';
  cards.forEach((c,i)=>{
    const node=document.createElement('div'); node.className='card'; if(hideFirst && i===0){ node.innerText='?'; node.style.background='#0f1724'; node.style.color='#fff'; } else { node.innerHTML = `${c.rank}<br><span style="font-size:11px">${c.suit}</span>`; node.style.background = (c.suit==='‚ô•' || c.suit==='‚ô¶') ? '#fff' : '#fff'; node.style.color = '#000'; }
    el.appendChild(node);
  });
}
function endBjRound(msg, payout=0){
  bjState.inRound=false; bjState.dealerHidden=false;
  bjHitBtn.disabled=true; bjStandBtn.disabled=true; bjDealBtn.disabled=false;
  if(payout>0) setBal(getBal()+payout);
  bjMsg.innerText = msg;
  renderCards(dealerCardsEl, bjState.dealer, false);
  dealerScoreEl.innerText = 'Dealer: ' + handValue(bjState.dealer);
  playerScoreEl.innerText = 'Player: ' + handValue(bjState.player);
}

bjDealBtn.addEventListener('click', ()=>{
  try{
    if(bjState.inRound) return;
    const bet = getBet(); bjState.bet = bet; setBal(getBal()-bet);
    bjState.deck = makeDeck();
    bjState.player = [bjState.deck.pop(), bjState.deck.pop()];
    bjState.dealer = [bjState.deck.pop(), bjState.deck.pop()];
    bjState.inRound = true; bjState.dealerHidden = true;
    renderCards(playerCardsEl, bjState.player); renderCards(dealerCardsEl, bjState.dealer, true);
    playerScoreEl.innerText = 'Player: ' + handValue(bjState.player);
    dealerScoreEl.innerText = 'Dealer: ?';
    bjMsg.innerText = 'Hit or Stand';
    bjHitBtn.disabled=false; bjStandBtn.disabled=false; bjDealBtn.disabled=true;
    // check naturals
    const pVal = handValue(bjState.player); const dVal = handValue(bjState.dealer);
    if(pVal===21 || dVal===21){
      bjState.dealerHidden=false;
      if(pVal===21 && dVal===21){
        // push
        setBal(getBal()+bet); endBjRound('Push ‚Äî both have blackjack. Bet returned.', bet);
      } else if(pVal===21){
        // player blackjack pays 1.5x
        const payout = Math.floor(bet * 2.5 * 100)/100; // returns bet + 1.5*bet = 2.5*bet
        setBal(getBal()+payout); endBjRound('Blackjack! You win 1.5x.', payout);
      } else {
        // dealer blackjack
        endBjRound('Dealer has blackjack. You lose.', 0);
      }
    }
  }catch(e){ alert(e) }
});

bjHitBtn.addEventListener('click', ()=>{
  if(!bjState.inRound) return;
  bjState.player.push(bjState.deck.pop());
  renderCards(playerCardsEl, bjState.player);
  const pVal = handValue(bjState.player);
  playerScoreEl.innerText = 'Player: ' + pVal;
  if(pVal>21){ endBjRound(`Busted at ${pVal}. You lose ${money(bjState.bet)}.`, 0); }
});

bjStandBtn.addEventListener('click', ()=>{
  if(!bjState.inRound) return;
  // reveal dealer and play dealer rules (hit until 17)
  bjState.dealerHidden=false;
  renderCards(dealerCardsEl, bjState.dealer);
  let dVal = handValue(bjState.dealer);
  while(dVal < 17){
    bjState.dealer.push(bjState.deck.pop());
    dVal = handValue(bjState.dealer);
    renderCards(dealerCardsEl, bjState.dealer);
  }
  const pVal = handValue(bjState.player);
  const dealerVal = dVal;
  if(dealerVal>21 || pVal>dealerVal){
    // player wins 1:1
    const payout = Math.floor(bjState.bet * 2 * 100)/100;
    setBal(getBal() + payout);
    endBjRound(`You win! Player ${pVal} vs Dealer ${dealerVal}. Payout ${money(payout)}.`, payout);
  } else if(pVal === dealerVal){
    // push
    setBal(getBal()+bjState.bet);
    endBjRound(`Push ‚Äî ${pVal}. Bet returned.`, bjState.bet);
  } else {
    endBjRound(`Dealer wins ${dealerVal}. You lose ${money(bjState.bet)}.`, 0);
  }
});

/* -------------------------
  NEW Roulette: wheel, bets and spin
  ------------------------- */

/* Wheel order ‚Äî European standard order (clockwise) */
const WHEEL_ORDER = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26]; // 37 numbers

/* color mapping for wheel numbers */
const RED_NUMS = new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]);
function wheelColor(n){
  if(n===0) return 'green';
  return RED_NUMS.has(n) ? 'red' : 'black';
}

/* Canvas wheel draw */
const canvas = document.getElementById('wheelCanvas');
const ctx = canvas.getContext('2d');
const size = canvas.width;
const cx = size/2;
const cy = size/2;
const radius = size/2 - 6;

function drawWheel(rotation=0){
  ctx.clearRect(0,0,size,size);
  ctx.save();
  ctx.translate(cx,cy);
  ctx.rotate(rotation);
  const sectors = WHEEL_ORDER.length;
  const sectorAngle = 2*Math.PI / sectors;
  // draw sectors
  for(let i=0;i<sectors;i++){
    const start = i*sectorAngle;
    const end = start + sectorAngle;
    // color
    const n = WHEEL_ORDER[i];
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.arc(0,0,radius,start,end,false);
    ctx.closePath();
    ctx.fillStyle = wheelColor(n) === 'red' ? '#b91c1c' : (wheelColor(n) === 'black' ? '#111827' : '#065f46');
    ctx.fill();
    // stroke
    ctx.strokeStyle = 'rgba(255,255,255,0.03)';
    ctx.stroke();
    // number label
    ctx.save();
    ctx.rotate(start + sectorAngle/2);
    ctx.translate(radius - 36, 0);
    ctx.rotate(Math.PI/2);
    ctx.fillStyle = '#fff';
    ctx.font = '12px Inter,Arial';
    ctx.textAlign = 'center';
    ctx.fillText(String(n), 0, 0);
    ctx.restore();
  }
  ctx.restore();
  // draw outer ring
  ctx.beginPath();
  ctx.arc(cx,cy,radius+4,0,2*Math.PI);
  ctx.strokeStyle = 'rgba(255,255,255,0.06)';
  ctx.lineWidth = 6;
  ctx.stroke();

  // draw arrow at top center
  ctx.beginPath();
  ctx.moveTo(cx, cy - radius - 14);
  ctx.lineTo(cx - 12, cy - radius + 10);
  ctx.lineTo(cx + 12, cy - radius + 10);
  ctx.closePath();
  ctx.fillStyle = '#ffd166';
  ctx.fill();
}

/* bets modelling */
let activeBets = []; // array of {type:'color'|'parity'|'range'|'number'|'dozen', val:..., amount:...}
const betsGrid = document.getElementById('betsGrid');
const numberGrid = document.getElementById('numberGrid');
const selectedBetDesc = document.getElementById('selectedBetDesc');
const totalWagerEl = document.getElementById('totalWager');
const rouletteMsg = document.getElementById('rouletteMsg');
const lastResultEl = document.getElementById('lastResult');

function updateTotal(){
  const total = activeBets.reduce((s,b)=>s + (Number(b.amount)||0),0);
  totalWagerEl.innerText = money(total);
}
function addBet(bet){
  activeBets.push(bet);
  renderActiveBets();
}
function clearBets(){
  activeBets = [];
  renderActiveBets();
}
function renderActiveBets(){
  if(activeBets.length === 0){
    selectedBetDesc.innerText = 'None';
  } else {
    const desc = activeBets.map(b => `${money(b.amount)} ‚Üí ${b.type}:${b.val}`).join(', ');
    selectedBetDesc.innerText = desc;
  }
  updateTotal();
}

/* populate number grid 0..36 */
function buildNumberGrid(){
  numberGrid.innerHTML = '';
  for(let n=0;n<=36;n++){
    const btn = document.createElement('button');
    btn.className = 'bet-btn';
    btn.innerText = String(n);
    btn.style.background = wheelColor(n) === 'red' ? '#b91c1c' : (wheelColor(n) === 'black' ? '#111827' : '#065f46');
    btn.style.color = '#fff';
    btn.dataset.num = n;
    btn.addEventListener('click', ()=>{
      try{
        const amt = getBet();
        if(amt > getBal()) { alert('Insufficient balance for that bet amount.'); return; }
        addBet({type:'number', val: Number(btn.dataset.num), amount: amt});
        showTempMessage(`Placed ${money(amt)} on ${btn.dataset.num}`);
      }catch(e){ alert(e) }
    });
    numberGrid.appendChild(btn);
  }
}
if(document.getElementById('rouletteGame')) buildNumberGrid();


/* bet buttons actions (color, parity, range, dozen) */
document.querySelectorAll('#betsGrid .bet-btn').forEach(b=>{
  b.addEventListener('click', () => {
    const type = b.dataset.bettype;
    const val = b.dataset.betval;
    try{
      const amt = getBet();
      if(amt > getBal()) { alert('Insufficient balance'); return; }
      addBet({type, val, amount:amt});
      showTempMessage(`Placed ${money(amt)} on ${type}:${val}`);
    }catch(e){ alert(e) }
  });
});

/* chip quick buttons: set betInput to chip value */
document.querySelectorAll('.chip').forEach(c => c.addEventListener('click', e => betInput.value = Number(e.currentTarget.dataset.chip)));

/* clear bets */
document.getElementById('clearBets').addEventListener('click', () => {
  if(confirm('Clear all pending bets?')) clearBets();
});

/* small helper to show transient message */
let tempMsgTimeout = null;
function showTempMessage(txt){
  rouletteMsg.innerText = txt;
  if(tempMsgTimeout) clearTimeout(tempMsgTimeout);
  tempMsgTimeout = setTimeout(()=> { rouletteMsg.innerText = 'Click a bet, set your bet amount, then press Spin.' }, 2500);
}

/* Spin wheel logic */
const spinWheelBtn = document.getElementById('spinWheelBtn');
let wheelSpinning = false;

function colorForResult(n){ return wheelColor(n); }

function computePayouts(result){
  const resColor = colorForResult(result);
  const resParity = (result !== 0) ? (result % 2 === 0 ? 'even' : 'odd') : null;
  const resRange = (result >=1 && result <=18) ? 'low' : (result >=19 && result <=36) ? 'high' : null;
  const payouts = [];
  activeBets.forEach(b => {
    const betAmt = Number(b.amount)||0;
    let won = false; let payout = 0; // total returned (including original bet)
    if(b.type === 'number'){
      if(b.val === result) { won = true; payout = betAmt * 36; }
    } else if(b.type === 'color'){
      if(result !== 0 && b.val === resColor) { won = true; payout = betAmt * 2; }
    } else if(b.type === 'parity'){
      if(result !== 0 && b.val === resParity) { won = true; payout = betAmt * 2; }
    } else if(b.type === 'range'){
      if(b.val === resRange) { won = true; payout = betAmt * 2; }
    } else if(b.type === 'dozen'){
      const n = result;
      let which = null;
      if(n>=1 && n<=12) which = '1';
      if(n>=13 && n<=24) which = '2';
      if(n>=25 && n<=36) which = '3';
      if(which === b.val){ won = true; payout = betAmt * 3; }
    }
    payouts.push({bet:b, won, payout});
  });
  return payouts;
}

let currentRotation = 0;
function spinToNumber(targetNumber, onComplete){
  const sectors = WHEEL_ORDER.length;
  const idx = WHEEL_ORDER.indexOf(targetNumber);
  if(idx < 0) { console.warn('Invalid target'); onComplete && onComplete(); return; }
  const sectorAngle = 2*Math.PI / sectors;
  const targetAngle = - (idx + 0.5) * sectorAngle;
  const spins = 5 + Math.floor(Math.random()*3);
  const finalRotation = currentRotation + spins * 2 * Math.PI + (targetAngle - (currentRotation % (2*Math.PI)));
  const duration = 4000 + Math.random()*1200;
  const start = performance.now();
  function animate(now){
    const t = Math.min(1, (now - start)/duration);
    const ease = 1 - Math.pow(1 - t, 3);
    const rot = currentRotation + (finalRotation - currentRotation) * ease;
    drawWheel(rot);
    if(t < 1) requestAnimationFrame(animate);
    else {
      currentRotation = finalRotation % (2*Math.PI);
      drawWheel(currentRotation);
      onComplete && onComplete();
    }
  }
  requestAnimationFrame(animate);
}

function randomWheelNumber(){ return WHEEL_ORDER[Math.floor(Math.random() * WHEEL_ORDER.length)]; }

if(spinWheelBtn) spinWheelBtn.addEventListener('click', async () => {
  if(wheelSpinning) return;
  if(activeBets.length === 0) { alert('Place at least one bet before spinning.'); return; }
  
  const total = activeBets.reduce((s,b)=>s + (Number(b.amount)||0),0);
  try{
    if(total > getBal()) { alert('Insufficient balance to place all bets.'); return; }
    setBal(getBal() - total);
  }catch(e){ alert(e); return; }

  wheelSpinning = true;
  spinWheelBtn.disabled = true;
  document.getElementById('rouletteMsg').innerText = 'Spinning...';
  const result = randomWheelNumber();
  spinToNumber(result, () => {
    wheelSpinning = false;
    spinWheelBtn.disabled = false;
    const payouts = computePayouts(result);
    let totalReturn = 0;
    let net = -total; // start with total wager as net loss
    payouts.forEach(p => {
      if(p.won){
        totalReturn += p.payout;
        net += p.payout;
      }
    });
    if(totalReturn > 0) setBal(getBal() + totalReturn);
    const col = wheelColor(result);
    document.getElementById('rouletteMsg').innerText = `Result: ${result} (${col.toUpperCase()}). Net ${money(net)}.`;
    lastResultEl.innerText = `Last: ${result} ${col}`;
    clearBets();
  });
});

if(document.getElementById('rouletteGame')) drawWheel(0);

/* -------------------------
  Baccarat
  ------------------------- */
/* Card utilities reused ‚Äî build a shoe with multiple decks */
function makeShoe(decks=6){
  const suits=['‚ô†','‚ô•','‚ô¶','‚ô£']; const ranks=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
  const shoe=[];
  for(let d=0;d<decks;d++){
    for(const s of suits) for(const r of ranks) shoe.push({suit:s,rank:r});
  }
  for(let i=shoe.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [shoe[i],shoe[j]]=[shoe[j],shoe[i]]; }
  return shoe;
}
function baccValue(card){
  if(!card) return 0;
  if(card.rank==='A') return 1;
  if(['K','Q','J','10'].includes(card.rank)) return 0;
  return Number(card.rank);
}
function baccTotal(cards){
  let s=0; for(const c of cards) s += baccValue(c); return s % 10;
}

const baccDealBtn = document.getElementById('baccDeal');
const baccMsg = document.getElementById('baccMsg');
const baccPlayerEl = document.getElementById('baccPlayer');
const baccBankerEl = document.getElementById('baccBanker');
const baccPlayerScore = document.getElementById('baccPlayerScore');
const baccBankerScore = document.getElementById('baccBankerScore');
const baccBetSelect = document.getElementById('baccBet');

let baccShoe = makeShoe(6);

baccDealBtn.addEventListener('click', ()=>{
  try{
    const bet = getBet(); const betType = baccBetSelect.value; setBal(getBal()-bet);
    if(baccShoe.length < 20) baccShoe = makeShoe(6);
    const player=[baccShoe.pop(), baccShoe.pop()];
    const banker=[baccShoe.pop(), baccShoe.pop()];
    let playerTotal = baccTotal(player), bankerTotal = baccTotal(banker);
    let thirdForPlayer = null;
    if(playerTotal >=8 || bankerTotal >=8){
    } else {
      if(playerTotal <=5){
        thirdForPlayer = baccShoe.pop(); player.push(thirdForPlayer);
      }
      bankerTotal = baccTotal(banker);
      if(thirdForPlayer === null){
        if(bankerTotal <=5){ banker.push(baccShoe.pop()); }
      } else {
        const p3 = baccValue(thirdForPlayer);
        if(bankerTotal <=2) { banker.push(baccShoe.pop()); }
        else if(bankerTotal === 3 && p3 !== 8){ banker.push(baccShoe.pop()); }
        else if(bankerTotal === 4 && p3>=2 && p3<=7){ banker.push(baccShoe.pop()); }
        else if(bankerTotal === 5 && p3>=4 && p3<=7){ banker.push(baccShoe.pop()); }
        else if(bankerTotal === 6 && (p3===6 || p3===7)){ banker.push(baccShoe.pop()); }
      }
    }
    playerTotal = baccTotal(player); bankerTotal = baccTotal(banker);
    baccPlayerEl.innerHTML = ''; baccBankerEl.innerHTML='';
    player.forEach(c=>{ const n=document.createElement('div'); n.className='card'; n.innerHTML = `${c.rank}<br><span style="font-size:11px">${c.suit}</span>`; baccPlayerEl.appendChild(n); });
    banker.forEach(c=>{ const n=document.createElement('div'); n.className='card'; n.innerHTML = `${c.rank}<br><span style="font-size:11px">${c.suit}</span>`; baccBankerEl.appendChild(n); });
    baccPlayerScore.innerText = 'Player: ' + playerTotal; baccBankerScore.innerText = 'Banker: ' + bankerTotal;
    let payout=0; let msg='';
    if(playerTotal > bankerTotal){
      if(betType === 'player'){ payout = Math.floor(bet * 2 * 100)/100; setBal(getBal()+payout); msg = `Player wins ${playerTotal} vs ${bankerTotal}. You won ${money(payout - bet)}.`; }
      else { msg = `Player wins ${playerTotal} vs ${bankerTotal}. You lost ${money(bet)}.`; }
    } else if(bankerTotal > playerTotal){
      if(betType === 'banker'){ const profit = Math.floor(bet * 0.95 * 100)/100; payout = Math.floor((bet + profit) * 100)/100; setBal(getBal()+payout); msg = `Banker wins ${bankerTotal} vs ${playerTotal}. You won ${money(payout - bet)} (0.95x).`; }
      else { msg = `Banker wins ${bankerTotal} vs ${playerTotal}. You lost ${money(bet)}.`; }
    } else {
      if(betType === 'tie'){ payout = Math.floor(bet * 9 * 100)/100; setBal(getBal()+payout); msg = `Tie ${playerTotal}. You won ${money(payout - bet)} (8:1).`; }
      else { setBal(getBal()+bet); msg = `Tie ${playerTotal}. Bet returned.`; payout = bet; }
    }
    baccMsg.innerText = msg;
  }catch(e){ alert(e) }
});

/* -------------------------
  Initial messages and sanity
  ------------------------- */
showMessage('coinMsg', 'Pick heads or tails and press Flip.');
showMessage('slotsMsg', 'Match symbols to win ‚Äî higher matches pay more.');
showMessage('plinkoMsg', 'Drop ball and hope it lands in a high-value bucket.');
showMessage('minesMsg', 'Choose mines count and press Start.');
showMessage('crashMsg', 'Start a round and cash out before the crash.');
document.getElementById('planeMsg').innerText = 'Start a flight ‚Äî plane will hit boosts/deductions on the way to the carrier. Cash out anytime.';
if(document.getElementById('rouletteMsg')) document.getElementById('rouletteMsg').innerText = 'Click a bet, set your bet amount, then press Spin.';


window.addEventListener('focus', ()=> { if(getBal()<0) setBal(0); renderBalance(); });
window.addEventListener('resize', ()=> { if(!planeState.running) resetPlaneUI(); renderMarkers(); });

/* End of script */
</script>
</body>
</html>
```
